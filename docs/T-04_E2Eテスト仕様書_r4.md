# T-04 E2Eテスト仕様書 (r4)

**版数:** r4
**作成日:** 2026-02-07
**改版日:** 2026-02-24
**依存:** T-01 テスト戦略書 (r2)

---

## 1. 概要

### 1.1 目的

本仕様書は、EAP-AKA RADIUS PoC環境のE2E（End-to-End）テストの試験項目・実行手順・合格基準を定義する。実機（SIMカード・無線LANアクセスポイント・端末デバイス）を用いたシステム全体の動作検証、およびeapaka_testを活用した擬似E2Eテストにより、本番相当環境での認証・課金・管理機能の正常動作を確認する。

### 1.2 スコープ

| 範囲内 | 範囲外 |
|:------|:------|
| 実SIM・実APを用いた実機テスト | 単体テスト（T-02で定義） |
| eapaka_testによる擬似E2Eテスト（実設定モード） | 結合テスト（T-03で定義） |
| ミニPC本番相当環境での動作検証 | 性能テスト（PoC対象外） |
| Admin TUI手動確認 | セキュリティテスト（PoC対象外） |

### 1.3 参照ドキュメント

| ドキュメント | 参照内容 |
|:------------|:--------|
| T-01 テスト戦略書 (r2) | テスト方針、品質ゲート、E2E必須シナリオ定義 |
| T-03 結合テスト仕様書 (r3) | 結合テスト構成パターン、eapaka_testシナリオ参考、テスト実施知見 |
| D-01 設計仕様書 (r8) | システム構成、通信フロー |
| D-02 Valkeyデータ設計仕様書 (r9) | データ構造、検証ポイント |
| D-08 インフラ設定・運用設計書 (r9) | Docker Compose、環境変数、ネットワーク構成 |
| D-09 Auth Server詳細設計書 (r8) | 認証処理フロー |
| D-10 Acct Server詳細設計書 (r4) | 課金処理フロー |
| S-01 eapaka_test利用ノウハウ (r1) | eapaka_testの設定・テストケース解説、SQN管理、運用知見 |

### 1.4 T-01必須シナリオとのマッピング

T-01テスト戦略書 セクション7.3で定義されたE2E必須シナリオ3件との対応:

| T-01 ID | T-01シナリオ名 | 本仕様書での対応シナリオ | subdoc |
|:--------|:-------------|:---------------------|:-------|
| E2E-001 | 実SIM認証成功 | E2E-001 | [real_sim_authentication.md](subdocs/T-04_E2E-001_real_sim_authentication.md) |
| E2E-002 | Accounting記録 | E2E-002 | [accounting_recording.md](subdocs/T-04_E2E-002_accounting_recording.md) |
| E2E-003 | Admin TUI確認 | E2E-003 | [admin_tui_verification.md](subdocs/T-04_E2E-003_admin_tui_verification.md) |

### 1.5 T-03（結合テスト）との主な違い

| 観点 | T-03 結合テスト | T-04 E2Eテスト |
|:-----|:-------------|:-------------|
| 実行環境 | Docker Compose内で完結 | ミニPC + 実AP + 実SIM |
| テストモード | `TEST_VECTOR_ENABLED=true` | `TEST_VECTOR_ENABLED=false` |
| テストツール | eapaka_test（テストベクター） | 実端末Wi-Fi接続 + eapaka_test（実計算） |
| シナリオ数 | 44件 | 11件 |
| データ準備 | redis-cliスクリプト | Admin TUI手動登録 |
| 自動化 | 一部自動化可能 | 手動実行中心 |
| テストピラミッド比率 | 25% | 5% |

### 1.6 シナリオID体系

```
E2E-{連番}

カテゴリ:
  E2E-001〜099  : 実機テスト（T-01必須シナリオ含む）
  E2E-101〜199  : 擬似E2E（eapaka_test利用、実SIM不要）
  E2E-201〜299  : 実機異常系
```

---

## 2. テスト環境

### 2.1 システム構成

```
┌─────────────────────────────────────────────────────────────────┐
│ ミニPC (Ubuntu Server 24.04)                                     │
│                                                                   │
│  ┌──────────────────────────────────────────┐                    │
│  │ Docker Compose環境                         │                    │
│  │                                            │                    │
│  │  auth-server (UDP 1812) ──→ vector-gateway │                    │
│  │       │                        │           │                    │
│  │       │                   vector-api       │                    │
│  │       │                        │           │                    │
│  │       └──────────┬─────────────┘           │                    │
│  │                  ↓                         │                    │
│  │  acct-server (UDP 1813) ──→ valkey         │                    │
│  │                                            │                    │
│  │  fluent-bit (ログ収集)                      │                    │
│  └──────────────────────────────────────────┘                    │
│                                                                   │
│  Admin TUI (ホスト実行) ──→ valkey (127.0.0.1:6379)              │
│                                                                   │
│  有線LAN接続                                                      │
│      │                                                            │
└──────┼────────────────────────────────────────────────────────────┘
       │
  ┌────┴────┐
  │ Wi-Fi AP │  WPA2/WPA3-Enterprise
  │ (802.1X) │  RADIUS Auth: ミニPC:1812
  │          │  RADIUS Acct: ミニPC:1813
  └────┬────┘
       │ Wi-Fi
  ┌────┴────────┐
  │ テスト端末    │  SIM挿入済み
  │ (Android等)  │  EAP-AKA/AKA'対応
  └─────────────┘
```

### 2.2 ミニPC要件

| 項目 | 要件 | 備考 |
|:-----|:-----|:-----|
| OS | Ubuntu Server 24.04 LTS | D-08参照 |
| CPU | 4コア以上（Intel N100相当） | D-08参照 |
| メモリ | 8GB以上 | Docker Compose全サービス動作 |
| ストレージ | 256GB SSD以上 | ログ保存含む |
| ネットワーク | 1GbE有線LAN | APと有線接続 |
| ソフトウェア | Docker、Docker Compose | E-01参照 |

### 2.3 環境変数（E2Eテスト用）

テスト実行に必要な主要環境変数（`deployments/.env` で設定）:

| 変数 | E2Eテスト時の値 | T-03との違い | 説明 |
|:----|:--------------|:-----------|:----|
| `TEST_VECTOR_ENABLED` | `false` | T-03では`true` | テストベクターモード**無効** |
| `TEST_VECTOR_IMSI_PREFIX` | （未使用） | T-03では`00101` | 実SIM使用のため不要 |
| `LOG_MASK_IMSI` | `false` | 同一 | IMSI全桁表示（テスト時） |
| `RADIUS_SECRET_KEY` | AP設定と一致させる | T-03では`testing123` | APのRADIUS設定と統一 |
| `VALKEY_PASSWORD` | 任意の強いパスワード | 同一 | Valkey認証パスワード |

> **重要:** E2Eテストでは`TEST_VECTOR_ENABLED=false`とする。これにより、Vector APIは実際のMilenage計算を行い、ValkeyのSIMパラメータ（Ki/OPc）を使用して認証ベクターを生成する。テストベクターモードが有効な場合、実SIMの認証は成功しない。

### 2.4 ネットワーク構成

| セグメント | IPレンジ（例） | 用途 |
|:---------|:-------------|:-----|
| Docker内部ネットワーク | 172.20.0.0/24 | コンテナ間通信 |
| ホストネットワーク | 192.168.x.0/24 | ミニPC ↔ AP間 |
| Wi-Fiクライアント | DHCP割当 | テスト端末のIPアドレス |

---

## 3. テストデータ準備

### 3.1 データ登録方法

E2Eテストでは、Admin TUIを使用してデータを登録する（T-03のredis-cliスクリプトとは異なる）。

| データ種別 | 登録手段 | 備考 |
|:---------|:--------|:-----|
| 加入者データ | Admin TUI → 加入者管理 | 実SIMのIMSI/Ki/OPcを登録 |
| RADIUSクライアント | Admin TUI → クライアント管理 | APのIPアドレス/Shared Secretを登録 |
| 認可ポリシー | Admin TUI → ポリシー管理 | テスト用SSIDの許可ルールを設定 |

### 3.2 加入者データ

| 項目 | 値 | 備考 |
|:-----|:----|:-----|
| IMSI | 実SIMのIMSI（15桁） | SIMカード付属情報から取得 |
| Ki | 実SIMのKi（128bit hex） | SIMカード付属情報から取得 |
| OPc | 実SIMのOPc（128bit hex） | SIMカード付属情報から取得 |
| AMF | `8000` | EAP-AKA/EAP-AKA'共通（`b9b9`はテストセット限定値） |
| SQN | `000000000001` | 初期値 |

> **sysmoISIM-SJA5の場合:** IMSI/Ki/OPcはSIMカードのプロビジョニングツール（pySim等）で読み取り可能。購入時の付属書類にも記載されている場合がある。

### 3.3 RADIUSクライアント

| 項目 | 値 | 備考 |
|:-----|:----|:-----|
| IPアドレス | APの実IPアドレス | AP管理画面で確認 |
| Shared Secret | AP設定と一致する値 | AP側RADIUS設定と同一 |
| NAS-Identifier | AP設定と一致する値 | AP側で設定した識別子 |

### 3.4 認可ポリシー

| 項目 | 値 | 備考 |
|:-----|:----|:-----|
| 対象IMSI | 実SIMのIMSI | 加入者データと一致 |
| デフォルトアクション | `allow` | テスト用に許可 |
| SSIDルール | APのSSID名を許可 | 必要に応じてワイルドカード`*` |
| NASルール | APのNAS-Identifierを許可 | 任意設定 |

### 3.5 擬似E2E用テストデータ

擬似E2Eテスト（E2E-101〜105）では、eapaka_testを使用するため、Admin TUIから以下のデータを登録する:

| 項目 | 値 | 備考 |
|:-----|:----|:-----|
| IMSI | `001010000000000` | 3GPP TS 35.208 Test Set 1 |
| Ki | `465b5ce8b199b49faa5f0a2ee238a6bc` | 同上 |
| OPc | `cd63cb71954a9f4e48a5994e37a02baf` | 同上 |
| AMF | `8000` | EAP-AKA用 |
| SQN | `000000000001` | 初期値 |

> **T-03との違い:** T-03ではテストベクターモード（`TEST_VECTOR_ENABLED=true`）により上記データのValkey登録は不要だったが、E2Eテストでは`TEST_VECTOR_ENABLED=false`のため、Valkeyへの明示的な登録が必要。

> **SQN管理に関する注意（r3追記、T-03知見）:** テストを繰り返すとSQNがインクリメントされ蓄積する。高SQN値はVector APIの「SQN difference exceeds allowed range」チェックに抵触し認証が失敗する場合がある。擬似E2Eテストの開始前に、対象IMSIのSQNを低値（`000000000001`）にリセットし、eapaka_testのSQNストアファイルも削除することを推奨する。
>
> ```bash
> # SQNリセット
> docker compose exec valkey redis-cli -a "$VALKEY_PASSWORD" HSET sub:001010000000000 sqn "000000000001"
> docker compose exec valkey redis-cli -a "$VALKEY_PASSWORD" HSET sub:001010000000002 sqn "000000000001"
> rm -f /tmp/eapaka_test-sqn-*.json
> ```

---

## 4. テストシナリオ一覧

### 4.1 カテゴリ別一覧

#### 実機テスト（必須）— 3件

| ID | シナリオ名 | テスト手段 | 検証内容 | 優先度 |
|:---|:---------|:----------|:---------|:------:|
| E2E-001 | 実SIM認証成功 | 実SIM + 実AP + 実端末 | Wi-Fi接続成功、IP取得 | 必須 |
| E2E-002 | Accounting記録 | 同上（E2E-001継続） | セッション情報がValkeyに記録 | 必須 |
| E2E-003 | Admin TUI確認 | Admin TUI | セッション一覧に表示 | 必須 |

#### 擬似E2E（推奨）— 5件

| ID | シナリオ名 | テスト手段 | 検証内容 | 優先度 |
|:---|:---------|:----------|:---------|:------:|
| E2E-101 | EAP-AKA認証（実設定モード） | eapaka_test | `TEST_VECTOR_ENABLED=false`での認証成功 | 推奨 |
| E2E-102 | EAP-AKA'認証（実設定モード） | eapaka_test | 同上（AKA'方式） | 推奨 |
| E2E-103 | SQN再同期（実設定モード） | eapaka_test | 実設定モードでの再同期成功 | 推奨 |
| E2E-104 | 認証→課金一連フロー | eapaka_test + radclient | 全フロー（Auth→Acct Start→Interim→Stop） | 推奨 |
| E2E-105 | ポリシー評価（実設定モード） | eapaka_test | ポリシールールの実設定環境での動作 | 推奨 |

#### 実機異常系（任意）— 3件

| ID | シナリオ名 | テスト手段 | 検証内容 | 優先度 |
|:---|:---------|:----------|:---------|:------:|
| E2E-201 | 未登録SIM接続試行 | 実SIM（未登録）+ 実AP | 認証失敗、適切なログ出力 | 任意 |
| E2E-202 | ポリシー拒否（不正SSID） | 実SIM + 実AP（別SSID） | ポリシー拒否の動作確認 | 任意 |
| E2E-203 | サービス再起動後の認証 | 実SIM + コンテナ再起動 | 再起動後の正常認証復旧 | 任意 |

### 4.2 実行順序と依存関係

```
テストデータ準備（Admin TUI）
    │
    ├──→ 擬似E2E（E2E-101〜105）  ※実SIM不要、先行実行推奨
    │
    └──→ 実機テスト準備（AP設定、SIM挿入）
            │
            ├──→ E2E-001（実SIM認証成功）
            │       │
            │       ├──→ E2E-002（Accounting記録）  ※E2E-001の継続
            │       │       │
            │       │       └──→ E2E-003（Admin TUI確認）  ※E2E-002の継続
            │       │
            │       └──→ E2E-201（未登録SIM接続試行）  ※E2E-001成功後
            │
            ├──→ E2E-202（ポリシー拒否）  ※AP設定変更が必要
            │
            └──→ E2E-203（サービス再起動後の認証）  ※最後に実施
```

> **推奨:** 擬似E2Eテスト（E2E-101〜105）を先行実行し、実設定モードでのシステム動作を確認した後に、実機テストに進む。これにより、実機テスト時の問題切り分けが容易になる。

---

## 5. 必須シナリオ詳細（E2E-001〜003）

T-01テスト戦略書で定義された必須3シナリオの詳細は、以下のsubdocで定義する。

### 5.1 E2E-001: 実SIM認証成功

**概要:** 実SIMを挿入したテスト端末からWi-Fi APに接続し、EAP-AKA/AKA'認証が成功してIPアドレスが取得できることを検証する。

**subdoc:** [T-04_E2E-001_real_sim_authentication.md](subdocs/T-04_E2E-001_real_sim_authentication.md)

**検証ポイント:**
- 端末がWi-Fi APに接続成功する
- 端末がDHCPでIPアドレスを取得する
- Auth Serverログに`AUTH_SUCCESS`イベントが記録される
- ValkeyにセッションデータSortedSet `sess:imsi:{IMSI}` が作成される

### 5.2 E2E-002: Accounting記録

**概要:** E2E-001で確立されたセッションに対するAccounting Start/Interim/Stopが正常に記録されることを検証する。

**subdoc:** [T-04_E2E-002_accounting_recording.md](subdocs/T-04_E2E-002_accounting_recording.md)

**検証ポイント:**
- Acct Serverログに`ACCT_START`/`ACCT_INTERIM`/`ACCT_STOP`イベントが記録される
- Valkeyのセッションデータが適切に更新される
- 重複検出用キー `acct:seen:{Acct-Session-Id}` が管理される

### 5.3 E2E-003: Admin TUI確認

**概要:** E2E-001〜002で作成されたセッション情報がAdmin TUIのセッション一覧画面に正しく表示されることを検証する。

**subdoc:** [T-04_E2E-003_admin_tui_verification.md](subdocs/T-04_E2E-003_admin_tui_verification.md)

**検証ポイント:**
- Admin TUIのセッション一覧にテスト端末のセッションが表示される
- セッション詳細画面でIMSI、NAS、Accounting情報が確認できる
- 加入者管理画面で登録済みSIMデータが正しく表示される

---

## 6. 擬似E2Eシナリオ詳細（E2E-101〜105）

eapaka_testを使用した擬似E2Eテストの詳細は、以下のsubdocで定義する。

**subdoc:** [T-04_pseudo_e2e_eapaka_test_scenarios.md](subdocs/T-04_pseudo_e2e_eapaka_test_scenarios.md)

### 6.1 擬似E2Eテストの位置づけ

擬似E2Eテストは、実SIM・実APを使わずに、本番相当の設定（`TEST_VECTOR_ENABLED=false`）でeapaka_testを実行する。T-03結合テスト（テストベクターモード）とE2E実機テストの中間に位置し、以下を検証する:

- 実際のMilenage計算パスが正常に動作すること
- ValkeyのSIMパラメータ（Ki/OPc）を使用したベクター生成が成功すること
- テストベクターモード依存の問題が本番設定で発生しないこと

### 6.2 T-03との差分

| 観点 | T-03 結合テスト | E2E-101〜105 擬似E2E |
|:-----|:-------------|:-------------------|
| `TEST_VECTOR_ENABLED` | `true` | `false` |
| Milenage計算 | スキップ（固定ベクター返却） | 実計算実行 |
| SIMパラメータ | 不要（テストベクターモード内蔵） | Valkey登録必須 |
| XRES検証 | 固定値で常に一致 | 実計算結果で検証 |

### 6.3 シナリオ概要

| ID | シナリオ名 | 検証内容 |
|:---|:---------|:---------|
| E2E-101 | EAP-AKA認証（実設定モード） | Milenage実計算パスでの認証成功 |
| E2E-102 | EAP-AKA'認証（実設定モード） | AKA'方式での実計算パス |
| E2E-103 | SQN再同期（実設定モード） | 実計算パスでの再同期成功 |
| E2E-104 | 認証→課金一連フロー | Auth成功→Acct Start→Interim→Stop |
| E2E-105 | ポリシー評価（実設定モード） | ポリシーallow/denyの動作確認 |

---

## 7. 実機異常系シナリオ詳細（E2E-201〜203）

### 7.1 E2E-201: 未登録SIM接続試行

**目的:** Valkeyに登録されていないSIMで接続を試みた際に、認証が適切に失敗することを検証する。

| 項目 | 内容 |
|:-----|:-----|
| 前提条件 | E2E-001が成功済み（システム正常動作確認済み） |
| テスト手段 | 未登録SIMを挿入した端末でWi-Fi AP接続試行 |
| 期待結果 | 接続失敗（認証エラー） |
| ログ検証 | Auth Serverログに`VECTOR_NOT_FOUND`または`AUTH_FAILURE`が記録される |

**手順:**
1. テスト端末にValkeyに未登録のSIMを挿入する
2. Wi-Fi APに接続を試行する
3. 接続が失敗することを確認する
4. Auth Serverログで認証失敗イベントを確認する

### 7.2 E2E-202: ポリシー拒否（不正SSID）

**目的:** ポリシーで許可されていないSSIDからの接続が拒否されることを検証する。

| 項目 | 内容 |
|:-----|:-----|
| 前提条件 | 登録済みSIM使用、ポリシーに特定SSIDのみ許可設定 |
| テスト手段 | ポリシー非許可のSSIDで接続試行 |
| 期待結果 | 接続失敗（ポリシー拒否） |
| ログ検証 | Auth Serverログに`AUTH_POLICY_DENIED`が記録される |

**手順:**
1. Admin TUIでテストSIMのポリシーを「特定SSIDのみ許可」に設定する
2. APに別のSSID（ポリシー非許可）を設定するか、別のAPを使用する
3. テスト端末でポリシー非許可SSIDに接続を試行する
4. 接続が失敗することを確認する
5. Auth Serverログでポリシー拒否イベントを確認する
6. テスト後、ポリシーを元に戻す

### 7.3 E2E-203: サービス再起動後の認証

**目的:** Docker Composeサービスを再起動した後に、認証が正常に復旧することを検証する。

| 項目 | 内容 |
|:-----|:-----|
| 前提条件 | E2E-001が成功済み |
| テスト手段 | `docker compose restart` 後に実SIM端末で再接続 |
| 期待結果 | 再起動後の認証成功 |
| ログ検証 | 再起動後のAuth Serverログに`AUTH_SUCCESS`が記録される |

**手順:**
1. Docker Composeサービスを再起動する
   ```bash
   cd deployments
   docker compose restart
   docker compose ps  # 全サービス起動確認
   ```
2. 全サービスのヘルスチェックが通過するまで待機する（約30秒）
3. **Valkeyのデータ残存を確認する（r3追記）**
   ```bash
   docker compose exec valkey redis-cli -a "$VALKEY_PASSWORD" KEYS "sub:*"     # 加入者データ
   docker compose exec valkey redis-cli -a "$VALKEY_PASSWORD" KEYS "client:*"  # クライアントデータ
   docker compose exec valkey redis-cli -a "$VALKEY_PASSWORD" KEYS "policy:*"  # ポリシーデータ
   ```
   > **T-03知見:** Valkey停止時、クライアントSecret検索が不可能なためサーバーはReject/Responseパケットを構築できず**無応答（タイムアウト）**となる。再起動後にデータが失われている場合は再投入が必要。
4. テスト端末のWi-Fiを一度切断し、再接続する
5. Wi-Fi接続が成功することを確認する
6. Auth Serverログで再起動後の認証成功イベントを確認する

---

## 8. 合格基準

### 8.1 T-01品質ゲート対応

| 品質ゲート項目 | 基準 | 対応シナリオ |
|:-------------|:----|:-----------|
| テスト成功率 100% | 必須シナリオ全件PASS | E2E-001, E2E-002, E2E-003 |
| 実機認証成功 1件以上 | 実SIMでWi-Fi接続成功 | E2E-001 |
| ログ出力確認 正常 | 認証フローがログで追跡可能 | E2E-001, E2E-002 |

### 8.2 必須シナリオの合格判定

| ID | シナリオ名 | 必須/推奨 | 合格条件 |
|:---|:---------|:--------:|:--------|
| E2E-001 | 実SIM認証成功 | **必須** | Wi-Fi接続成功、IP取得、AUTH_SUCCESSログ |
| E2E-002 | Accounting記録 | **必須** | Valkeyにセッション記録、Acctログ出力 |
| E2E-003 | Admin TUI確認 | **必須** | セッション一覧に表示 |

### 8.3 擬似E2Eシナリオの合格判定

| ID | シナリオ名 | 必須/推奨 | 合格条件 |
|:---|:---------|:--------:|:--------|
| E2E-101 | EAP-AKA認証（実設定モード） | 推奨 | eapaka_test Access-Accept |
| E2E-102 | EAP-AKA'認証（実設定モード） | 推奨 | eapaka_test Access-Accept |
| E2E-103 | SQN再同期（実設定モード） | 推奨 | eapaka_test Access-Accept（再同期後） |
| E2E-104 | 認証→課金一連フロー | 推奨 | 全ステップ成功、Valkey状態正常 |
| E2E-105 | ポリシー評価（実設定モード） | 推奨 | allow時Accept、deny時Reject |

### 8.4 実機異常系シナリオの合格判定

| ID | シナリオ名 | 必須/推奨 | 合格条件 |
|:---|:---------|:--------:|:--------|
| E2E-201 | 未登録SIM接続試行 | 任意 | 接続失敗、エラーログ出力 |
| E2E-202 | ポリシー拒否（不正SSID） | 任意 | 接続失敗、POLICY_DENIEDログ |
| E2E-203 | サービス再起動後の認証 | 任意 | 再起動後の認証成功 |

### 8.5 全体合格判定

| レベル | 条件 | 判定 |
|:------|:-----|:-----|
| 最低合格 | E2E-001〜003 全PASS | T-01品質ゲート充足 |
| 推奨合格 | 上記 + E2E-101〜105 全PASS | 擬似E2Eによる品質補強 |
| 完全合格 | 全11シナリオ PASS | 異常系含む完全検証 |

---

## 9. 実行チェックリスト

### 9.1 事前準備

```
[ ] 1. ミニPC環境構築完了（D-08, E-01参照）
[ ] 2. Docker Compose全サービス起動確認
[ ] 3. 環境変数設定（TEST_VECTOR_ENABLED=false）
[ ] 4. Admin TUIで加入者データ登録（実SIM情報）
[ ] 5. Admin TUIでRADIUSクライアント登録（APのIP/Secret）
[ ] 6. Admin TUIでポリシー設定（テスト用SSID許可）
[ ] 7. Wi-Fi AP設定（RADIUS Auth/Acctサーバー指定）
[ ] 8. テスト端末にSIM挿入、Wi-Fi設定（EAP-AKA/AKA'）
[ ] 9. eapaka_testインストール・設定確認（擬似E2E用）
```

### 9.2 テスト実行

```
[ ] 10. 擬似E2E: E2E-101〜105 実行（実SIM不要）
[ ] 11. 実機テスト: E2E-001 実SIM認証成功
[ ] 12. 実機テスト: E2E-002 Accounting記録確認
[ ] 13. 実機テスト: E2E-003 Admin TUI確認
[ ] 14. （任意）実機異常系: E2E-201 未登録SIM接続試行
[ ] 15. （任意）実機異常系: E2E-202 ポリシー拒否
[ ] 16. （任意）実機異常系: E2E-203 サービス再起動後の認証
```

### 9.3 事後確認

```
[ ] 17. テスト結果の記録（PASS/FAIL、スクリーンショット）
[ ] 18. Auth Server/Acct Serverログの保存
[ ] 19. Valkeyデータのダンプ（検証用）
[ ] 20. テスト環境のクリーンアップ（テストデータ削除）
[ ] 21. テスト結果レポート作成
```

---

## 付録A: 実機機材仕様

### A.1 SIMカード

| 項目 | 推奨仕様 | 備考 |
|:-----|:--------|:-----|
| 製品名 | sysmoISIM-SJA5 | sysmocom製テスト用ISIM |
| 形状 | Nano SIM / Micro SIM | アダプタで変換可能 |
| 対応プロトコル | EAP-AKA, EAP-AKA' | USIM/ISIMアプレット搭載 |
| パラメータ | IMSI/Ki/OPc既知 | プロビジョニングツールで確認可能 |
| PLMN | 00101（テスト用） | Test PLMN |
| 入手先 | sysmocom公式サイト | https://shop.sysmocom.de/ |

### A.2 無線LAN AP

| 項目 | 推奨仕様 | 備考 |
|:-----|:--------|:-----|
| 認証方式 | WPA2-Enterprise (802.1X) | WPA3-Enterprise対応であれば望ましい |
| RADIUS設定 | Auth Port 1812, Acct Port 1813 | ミニPCのIPアドレスを指定 |
| SSID設定 | テスト用SSID作成可能 | 管理画面からSSID追加可能なもの |
| 推奨製品例 | TP-Link EAP245、Ubiquiti UniFi等 | ビジネスグレードAP |
| 有線LAN | 1GbE | ミニPCと有線接続 |

### A.3 テスト端末

| 項目 | 推奨仕様 | 備考 |
|:-----|:--------|:-----|
| OS | Android 10以降 | EAP-AKA/AKA'のWi-Fi設定対応 |
| SIMスロット | あり | テストSIM挿入用 |
| Wi-Fi | 802.11ac以降 | 5GHz帯対応推奨 |
| Wi-Fi認証 | EAP-AKA/AKA'選択可能 | Wi-Fi設定画面で方式選択 |
| 代替 | モバイル通信対応Windows PC | SIMスロット内蔵かつWi-FiでEAP-AKA対応が必要 |

> **注意:** SIMカードリーダー経由のSIM接続では、Wi-Fi認証時にSIMを認識できないため、E2Eテストには利用できない。テスト端末にはSIMスロットを内蔵し、OSのWi-Fi設定画面でEAP-AKA/AKA'方式を選択できるデバイスが必要。

---

## 付録B: 参照subdocs一覧

| ドキュメント | 内容 | セクション参照 |
|:------------|:-----|:-------------|
| [T-04_E2E-001_real_sim_authentication.md](subdocs/T-04_E2E-001_real_sim_authentication.md) | 実SIM認証成功シナリオ詳細 | 5.1 |
| [T-04_E2E-002_accounting_recording.md](subdocs/T-04_E2E-002_accounting_recording.md) | Accounting記録シナリオ詳細 | 5.2 |
| [T-04_E2E-003_admin_tui_verification.md](subdocs/T-04_E2E-003_admin_tui_verification.md) | Admin TUI確認シナリオ詳細 | 5.3 |
| [T-04_pseudo_e2e_eapaka_test_scenarios.md](subdocs/T-04_pseudo_e2e_eapaka_test_scenarios.md) | 擬似E2Eシナリオ詳細（E2E-101〜105） | 6 |
| [T-04_environment_setup_guide.md](subdocs/T-04_environment_setup_guide.md) | E2E環境構築ガイド | 2, 付録A |
| [T-04_troubleshooting_guide.md](subdocs/T-04_troubleshooting_guide.md) | トラブルシューティング | — |

---

## 改訂履歴

| 版数 | 日付 | 内容 |
|:-----|:-----|:-----|
| r1 | 2026-02-07 | 初版作成 |
| r2 | 2026-02-07 | レビュー反映: セクション3.2 AMF値をEAP-AKA/AKA'共通`8000`に統一（`b9b9`はテストセット限定）、付録A.3 テスト端末の代替をモバイル通信対応PCに修正（SIMリーダー経由は不可） |
| r3 | 2026-02-16 | T-03結合テスト再実施（20260216）の知見を反映: |
| | | - 参照ドキュメント版数更新（T-03: r1→r3, D-08: r8→r9, D-10: r5→r4） |
| | | - SQN管理の注意事項を追加（テスト前リセット推奨、SQNストアファイル削除） |
| | | - E2E-203にValkey再起動後のデータ残存確認手順を追加 |
| | | - E2E-203にValkey停止時の無応答挙動（Secret検索不可）の知見を注記 |
| | | - 擬似E2Eシナリオ詳細subdocにradclient入力方式・SQNリセット手順・トラブルシューティングを追加 |
| r4 | 2026-02-24 | eapaka_test利用ノウハウ補足資料（S-01）作成に伴う更新: |
| | | - 参照ドキュメントにS-01 eapaka_test利用ノウハウ(r1)を追加 |
| | | - 擬似E2Eシナリオ詳細subdocのeapaka_testパス定義をsupplement配下に変更 |
