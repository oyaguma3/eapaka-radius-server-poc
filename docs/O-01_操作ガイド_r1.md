# O-01 操作ガイド (r1)

## 1. 概要

### 1.1 目的

本ドキュメントは、EAP-AKA/AKA' RADIUS PoC環境における管理コンソール「Admin TUI」の操作手順を説明する実務ガイドである。加入者管理、RADIUSクライアント管理、インポート/エクスポート、モニタリングの各機能について、操作手順とキーバインドを記載する。

### 1.2 対象読者

- 運用担当者
- E2Eテスト実施者

### 1.3 前提条件

- B-02（アプリケーションデプロイ手順書）の手順に従いデプロイ済みであること
- Admin TUIバイナリがホストOS上に配置済みであること
- Valkeyコンテナが稼働中であること

### 1.4 関連ドキュメント

| ドキュメント | 内容 |
|-------------|------|
| D-05 Admin TUI詳細設計書【前半】(r9) | 画面設計、バリデーション、インポート/エクスポート仕様 |
| D-07 Admin TUI詳細設計書【後半】(r7) | モニタリング画面、ヘルプダイアログ仕様 |
| D-02 Valkeyデータ設計仕様書 (r10) | Valkeyキー設計、データ構造 |
| B-02 アプリケーションデプロイ手順書 (r6) | Admin TUI配置手順 |
| O-02 ポリシー設定ガイド (r1) | 認可ポリシーの詳細設定手順 |
| O-05 ログ解析ガイド (r3) | ログ解析・障害調査手順 |

---

## 2. Admin TUI の起動と終了

### 2.1 起動方法

ホストOSにSSH接続後、Admin TUIバイナリを実行する。

```bash
# 環境変数を設定して起動
export VALKEY_ADDR=127.0.0.1:6379
export VALKEY_PASSWORD=<Valkeyパスワード>
./admin-tui
```

| 環境変数 | 必須 | デフォルト | 説明 |
|----------|------|-----------|------|
| `VALKEY_ADDR` | No | `127.0.0.1:6379` | Valkey接続先アドレス |
| `VALKEY_PASSWORD` | Yes | - | Valkey認証パスワード |

### 2.2 起動エラー時の対処

Valkey接続に失敗した場合、以下のエラーダイアログが表示される。

```
       ┌ Connection Error ────────────────────────────────────┐
       │                                                      │
       │  Failed to connect to Valkey:                        │
       │                                                      │
       │  {実際のエラーメッセージ}                                │
       │                                                      │
       │  Please check:                                       │
       │  - Valkey is running on 127.0.0.1:6379               │
       │  - VALKEY_PASSWORD environment variable is set       │
       │    correctly                                         │
       │                                                      │
       │          < Retry >     < Exit >                      │
       │                                                      │
       └──────────────────────────────────────────────────────┘
```

| ボタン | 動作 |
|--------|------|
| `Retry` | Valkey接続を再試行 |
| `Exit` | アプリケーションを終了 |

**確認事項:**
- Valkeyコンテナが起動しているか: `cd ~/eapaka-radius-server-poc/deployments && docker compose ps valkey`
- `VALKEY_PASSWORD` 環境変数が正しく設定されているか

### 2.3 メインメニュー

起動に成功すると、メインメニューが表示される。番号キーまたは矢印キー+Enterで各機能に遷移する。

```
┌ Admin TUI - Main Menu ──────────────────────────────────────┐
│                                                             │
│ (1) Subscriber Management                                   │
│     Manage subscriber data (IMSI, Ki, OPc, etc.)            │
│                                                             │
│ (2) RADIUS Client Management                                │
│     Manage RADIUS client (NAS) configurations               │
│                                                             │
│ (3) Authorization Policy Management                         │
│     Manage access control policies for subscribers          │
│                                                             │
│ (4) Import/Export                                           │
│     Import or export data as CSV files                      │
│                                                             │
│ (5) Monitoring                                              │
│     View statistics and active sessions                     │
│                                                             │
│ (q) Exit                                                    │
│     Exit the application                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
F1:Help  |  q:Back/Quit  |  Ctrl+Q:Exit
```

| キー | 動作 |
|------|------|
| `1` | 加入者管理画面へ |
| `2` | RADIUSクライアント管理画面へ |
| `3` | 認可ポリシー管理画面へ |
| `4` | インポート/エクスポート画面へ |
| `5` | モニタリング画面へ |
| `q` / `Esc` | 終了確認ダイアログ表示 |

### 2.4 終了方法

| 方法 | 動作 |
|------|------|
| メインメニューで `q` または `Esc` | 終了確認ダイアログ表示後、`Exit` 選択で終了 |
| `Ctrl+Q` | 確認なしで即座に終了（全画面で有効） |

### 2.5 グローバルキーバインド

全画面で有効なキーバインド。

| キー | 動作 |
|------|------|
| `F1` / `?` | ヘルプダイアログ表示 |
| `Esc` | 前の画面に戻る / キャンセル |
| `Ctrl+Q` | アプリケーション終了（確認なし） |
| `Tab` | 次のフォーカス要素へ移動 |
| `Shift+Tab` | 前のフォーカス要素へ移動 |

---

## 3. 加入者管理（Subscriber Management）

メインメニューから `1` キーで遷移する。EAP-AKA認証に必要な加入者情報（IMSI, Ki, OPc, AMF, SQN）を管理する。

### 3.1 加入者一覧画面

```
┌ Subscriber List 1-9 of 9 (Page 1/1) ───────────────────────────────────────────────┐
│  IMSI             Ki              OPc              AMF    SQN            Created   │
│  001010000000000  465B5CE8...A6BC CD63CB71...2BAF  B9B9   000000000001   2024-01-01│
│  001010000000001  465B5CE8...A6BC CD63CB71...2BAF  B9B9   000000000021   2024-01-01│
│  001010000000003  465B5CE8...A6BC CD63CB71...2BAF  8000   0000000000c1   2024-01-01│
│! 001010000000007  465B5CE8...A6BC CD63CB71...2BAF  B9B9   ff9bb4d0b687   2024-01-01│
│! 441991234567890  465B5CE8...A6BC CD63CB71...2BAF  B9B9   FF9BB4D0B607   2024-01-01│
│  :                :               :                :      :              :         │
└────────────────────────────────────────────────────────────────────────────────────┘
F1:Help  |  q:Back/Quit  |  Ctrl+Q:Exit
```

#### 表示カラム

| カラム | 内容 | 備考 |
|--------|------|------|
| IMSI | 加入者識別番号（15桁） | ポリシー未設定時はYellow表示、行頭に `!` 表示 |
| Ki | 認証鍵（マスク表示） | 先頭8文字...末尾4文字（例: `465B5CE8...A6BC`） |
| OPc | オペレータ鍵（マスク表示） | 先頭8文字...末尾4文字（例: `CD63CB71...2BAF`） |
| AMF | 認証管理フィールド | 4桁Hex |
| SQN | シーケンス番号 | 12桁Hex |
| Created | 作成日 | YYYY-MM-DD形式 |

**ポリシー未設定の視覚的識別:** ポリシー（`policy:{IMSI}`）が登録されていない加入者は、行全体がYellow/Orange表示となり、IMSIカラムの先頭に `!` プレフィックスが付く。ポリシー未設定の加入者は認証時にAccess-Rejectとなるため、加入者登録後にポリシーの登録が必要である。

#### キーバインド

| キー | 動作 |
|------|------|
| `↑` / `↓` | カーソル上下移動 |
| `PgUp` / `PgDn` | ページ上下移動 |
| `Enter` / `F3` / `e` | 選択した加入者の編集画面へ |
| `F2` / `n` | 新規登録画面へ |
| `F4` / `d` | 削除確認ダイアログ表示 |
| `F5` / `r` | 一覧を再読み込み |
| `F6` / `/` | フィルタ入力ダイアログ表示 |
| `Esc` / `q` | メインメニューへ戻る |

#### ページネーション

1ページあたり50件を表示する。ボーダータイトルにページ情報（例: `1-50 of 125 (Page 1/3)`）が表示される。

| キー | 動作 |
|------|------|
| `←` | 前のページ |
| `→` | 次のページ |

#### フィルタ

`/` キーでフィルタ入力ダイアログが表示される。入力した文字列で全カラムに対して部分一致検索を行い、該当する行のみ表示する（大文字小文字の区別なし）。フィルタ適用時はボーダータイトルに `(Filter: "入力値")` が付加される。フィルタは `Esc` でクリアできる。

### 3.2 加入者の新規登録

一覧画面で `F2` または `n` キーを押すと、新規登録フォームが表示される。

```
              ┌ Create Subscriber ────────────────────────────────┐
              │                                                   │
              │  IMSI    [001010000000008       ]                 │
              │  Ki      [0123456789ABCDEF0123456789ABCDEF     ]  │
              │  OPc     [FEDCBA9876543210FEDCBA9876543210     ]  │
              │  AMF     [8000      ]                             │
              │  SQN     [000000000000   ]                        │
              │                                                   │
              │          < Save >  < Cancel >                     │
              │                                                   │
              └───────────────────────────────────────────────────┘
```

#### 入力フィールド

| フィールド | 必須 | 初期値 | 入力規則 |
|-----------|------|-------|---------|
| IMSI | Yes | 空 | 15桁の数字 |
| Ki | Yes | 空 | 32桁のHex文字 |
| OPc | Yes | 空 | 32桁のHex文字 |
| AMF | Yes | `8000` | 4桁のHex文字 |
| SQN | No | `000000000000` | 12桁のHex文字 |

**入力補助:**
- Hexフィールド（Ki, OPc, AMF, SQN）は小文字入力が自動的に大文字に変換される
- 0-9, A-F, a-f 以外の文字は受け付けない

**保存時の動作:**
- 全フィールドのバリデーションが実行される
- 同一IMSIが既に存在する場合、上書き確認ダイアログが表示される

### 3.3 加入者の編集

一覧画面で加入者を選択し `Enter`、`F3`、または `e` キーを押すと、編集フォームが表示される。

```
              ┌ Edit Subscriber ──────────────────────────────────┐
              │                                                   │
              │  IMSI    [001010000000008       ]  (disabled)     │
              │  Ki      [0123456789ABCDEF0123456789ABCDEF     ]  │
              │  OPc     [FEDCBA9876543210FEDCBA9876543210     ]  │
              │  AMF     [8000      ]                             │
              │  SQN     [000000000000   ]                        │
              │                                                   │
              │          < Save >  < Cancel >                     │
              │                                                   │
              └───────────────────────────────────────────────────┘
```

- **IMSI** は読取専用（グレーアウト、編集不可）
- その他のフィールド（Ki, OPc, AMF, SQN）は編集可能

#### SQN変更時の警告

SQNフィールドを変更して保存しようとすると、以下の警告ダイアログが表示される。SQNの不適切な変更は認証失敗の原因となるため、注意が必要である。

```
        ┌ SQN Modification Warning ────────────────────────────────┐
        │                                                          │
        │                    ⚠WARNING ⚠                           │
        │                                                          │
        │  Modifying the SQN value may cause                       │
        │  authentication failures.                                │
        │                                                          │
        │  Are you sure you want to change the SQN                 │
        │  from                                                    │
        │    000000000000 to 000000000010?                         │
        │                                                          │
        │           < Continue >     < Cancel >                    │
        │                                                          │
        └──────────────────────────────────────────────────────────┘
```

### 3.4 加入者の削除

一覧画面で加入者を選択し `F4` または `d` キーを押すと、削除確認ダイアログが表示される。

```
Delete IMSI: 440101234567890?
This action cannot be undone.

[Delete] [Cancel]
```

**注意:** 削除操作は取り消しできない。削除前にエクスポート機能でバックアップを取得することを推奨する。

---

## 4. RADIUSクライアント管理（RADIUS Client Management）

メインメニューから `2` キーで遷移する。RADIUS認証・課金リクエストを送信するNAS/APのクライアント情報を管理する。

### 4.1 クライアント一覧画面

```
┌ RADIUS Client List 1-6 of 6 (Page 1/1) ────────────────────────────────┐
│ IP Address        Name               Secret          Vendor            │
│ 10.0.0.100        E2E-NAS            e2****as        generic           │
│ 127.0.0.1         Localhost          TE****23        generic           │
│ 172.19.0.1        DockerGateway      TE****23        generic           │
│ 192.168.1.10      TestAP-01          te****p1        generic           │
│ 192.168.10.1      Customer01         TE****23        generic           │
│ 192.168.30.1      testClient         ab****mn        none              │
└────────────────────────────────────────────────────────────────────────┘
F1:Help  |  q:Back/Quit  |  Ctrl+Q:Exit
```

#### 表示カラム

| カラム | 内容 | 備考 |
|--------|------|------|
| IP Address | クライアントIPアドレス | - |
| Name | クライアント名称 | 長い場合は `...` で切り詰め |
| Secret | 共有シークレット（マスク表示） | 先頭2文字+****+末尾2文字（例: `e2****as`） |
| Vendor | ベンダー名 | 空の場合は `none` と表示 |

#### キーバインド

一覧画面共通キーバインド（セクション3.1参照）と同様。

### 4.2 クライアントの新規登録

一覧画面で `F2` または `n` キーを押すと、新規登録フォームが表示される。

```
              ┌ Create RADIUS Client ─────────────────────────────┐
              │                                                   │
              │  IP Address  [255.255.255.255    ]                │
              │  Secret      [ABCDEFGHIJKLMNOPQRSTUVWXYZ       ]  │
              │  Name        [TestClient                       ]  │
              │  Vendor      [unknown                          ]  │
              │                                                   │
              │          < Save >  < Cancel >                     │
              │                                                   │
              └───────────────────────────────────────────────────┘
```

#### 入力フィールド

| フィールド | 必須 | 入力規則 |
|-----------|------|---------|
| IP Address | Yes | 有効なIPv4アドレス |
| Secret | Yes | 1〜128文字（ASCII印字可能文字） |
| Name | No | 0〜64文字 |
| Vendor | No | 0〜32文字（英数字とハイフン） |

### 4.3 クライアントの編集

一覧画面でクライアントを選択し `Enter`、`F3`、または `e` キーを押すと、編集フォームが表示される。

- **IP Address** は読取専用（グレーアウト、編集不可）
- その他のフィールド（Secret, Name, Vendor）は編集可能

### 4.4 クライアントの削除

一覧画面でクライアントを選択し `F4` または `d` キーを押すと、削除確認ダイアログが表示される。

```
Delete client: 192.168.1.100?
This action cannot be undone.

[Delete] [Cancel]
```

---

## 5. 認可ポリシー管理（Authorization Policy Management）— 簡易説明

### 5.1 概要

メインメニューから `3` キーで認可ポリシー管理画面にアクセスする。認可ポリシーはIMSI単位のアクセス制御を定義するもので、認証成功後にどのSSID/NASからの接続を許可するかを制御する。

### 5.2 画面構成の概要

認可ポリシー管理は以下の3階層で構成される。

**第1階層: ポリシー一覧画面**

登録済みポリシーの一覧（IMSI, Default Action, Rules数）を表示する。

```
┌ Authorization Policy List 1-9 of 9 (Page 1/1) ───────────────────────────┐
│ IMSI              Default   Rules                                        │
│ 001010000000000   allow     No rules                                     │
│ 001010000000001   allow     No rules                                     │
│ 001010000000002   deny      No rules                                     │
│ 001010000000003   deny      1 rule                                       │
│ 001010000000004   deny      2 rules                                      │
│  :                :         :                                            │
└──────────────────────────────────────────────────────────────────────────┘
```

- Default列: `allow` = Yellow/Orange表示、`deny` = Green表示
- Rules列: `No rules` / `1 rule` / `N rules` 形式

**第2階層: ポリシー詳細フォーム**

IMSI、Default Action（deny/allow）、ルールリストを編集する。

**第3階層: ルール編集ダイアログ**

個別ルールのNAS ID、Allowed SSIDs、VLAN ID、Session Timeoutを設定する。

### 5.3 詳細操作

認可ポリシーの詳細な設定方法（NAS-ID/SSID設定例、VLAN割り当て例、トラブルシューティング）については、**O-02 ポリシー設定ガイド** を参照すること。

ポリシー管理画面の操作キーは他の一覧画面と共通（セクション3.1のキーバインド参照）。追加のキーバインドとして、ポリシー詳細フォームでは `F6` キーでフォーム部分とルールリスト間のフォーカスを切り替える。

---

## 6. インポート/エクスポート（Import/Export）

メインメニューから `4` キーで遷移する。加入者データ、RADIUSクライアント、認可ポリシーをCSVファイルで一括入出力する。

### 6.1 インポート操作

#### 手順

1. Data Type ドロップダウンからインポート対象を選択する（`Subscribers` / `RADIUS Clients` / `Policies`）
2. File Path にCSVファイルのパスを入力する
3. `Validate` ボタンを押してバリデーションを実行する（Phase 1）
4. バリデーション成功後、`Import` ボタンを押してインポートを実行する（Phase 2）

```
┌ Import Data ───────────────────────────────────────────────────────┐
│                                                                    │
│  Data Type    [Subscribers      ▼]                                 │
│  File Path    [/home/admin/import.csv                          ]   │
│                                                                    │
│  < Validate >  < Import >  < Cancel >                              │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
┌ Import Result ─────────────────────────────────────────────────────┐
│                                                                    │
│  (結果表示エリア — スクロール可能)                                      │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

#### 2フェーズインポート

| フェーズ | 動作 | エラー時 |
|---------|------|---------|
| Phase 1: Validate | CSVの全行を読み込み、バリデーション実行 | エラー一覧を結果エリアに表示、インポートは実行されない |
| Phase 2: Import | Valkeyトランザクションで一括投入 | トランザクション失敗時はロールバック |

#### 完了後の画面

インポート完了後、フォームタイトルが「Import Completed」に変わり、ボタンが `Done` / `Import More` に切り替わる。

```
┌ Import Completed ──────────────────────────────────────────────────┐
│                                                                    │
│  < Done >  < Import More >                                         │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
┌ Import Result ─────────────────────────────────────────────────────┐
│                                                                    │
│  Import completed!                                                 │
│  Imported: 15 subscribers                                          │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

### 6.2 エクスポート操作

#### 手順

1. Data Type ドロップダウンからエクスポート対象を選択する
2. Output File に出力先ファイルパスを入力する（デフォルト命名規則あり）
3. `Export` ボタンを押してエクスポートを実行する

```
┌ Export Data ──────────────────────────────────────────────────────┐
│                                                                   │
│  Data Type     [Subscribers      ▼]                               │
│  Output File   [/home/admin/subscriber_export_20260223.txt     ]  │
│                                                                   │
│  < Export >  < Cancel >                                           │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

#### デフォルトファイル名

| データタイプ | ファイル名例 |
|-------------|-------------|
| Subscribers | `subscribers_YYYYMMDD_HHMMSS.csv` |
| RADIUS Clients | `clients_YYYYMMDD_HHMMSS.csv` |
| Policies | `policies_YYYYMMDD_HHMMSS.csv` |

#### 完了後の画面

エクスポート完了後、ボタンが `Done` / `Export More` に切り替わり、結果エリアに件数とファイルパスが表示される。

### 6.3 CSVフォーマット仕様

#### 加入者CSV

```csv
imsi,ki,opc,amf,sqn
440101234567890,0123456789ABCDEF0123456789ABCDEF,FEDCBA9876543210FEDCBA9876543210,8000,000000000000
440101234567891,ABCDEF0123456789ABCDEF0123456789,0123456789ABCDEFFEDCBA9876543210,8000,000000000001
```

| カラム | 必須 | 説明 |
|--------|------|------|
| `imsi` | Yes | 15桁の数字 |
| `ki` | Yes | 32桁のHex文字（大文字小文字どちらも可、インポート時に大文字へ正規化） |
| `opc` | Yes | 32桁のHex文字（同上） |
| `amf` | Yes | 4桁のHex文字 |
| `sqn` | Yes | 12桁のHex文字 |

#### RADIUSクライアントCSV

```csv
ip,secret,name,vendor
192.168.1.100,mysecret123,AP-Floor1,cisco
192.168.1.101,anothersecret,AP-Floor2,
```

| カラム | 必須 | 説明 |
|--------|------|------|
| `ip` | Yes | 有効なIPv4アドレス |
| `secret` | Yes | 共有シークレット（空文字不可） |
| `name` | Yes | クライアント名称 |
| `vendor` | No | ベンダー名（空欄可） |

#### 認可ポリシーCSV

```csv
imsi,default,rules_json
440101234567890,deny,"[{""nas_id"":""*"",""allowed_ssids"":[""CORP-WIFI"",""GUEST""],""vlan_id"":""10"",""session_timeout"":7200}]"
440101234567891,allow,[]
```

| カラム | 必須 | 説明 |
|--------|------|------|
| `imsi` | Yes | 15桁の数字 |
| `default` | Yes | デフォルトアクション（`allow` または `deny`） |
| `rules_json` | No | ポリシールールのJSON配列（空文字列または `[]` で空ルール） |

`rules_json` の各ルールオブジェクト:

| フィールド | 必須 | 説明 |
|-----------|------|------|
| `nas_id` | Yes | NAS識別子（ワイルドカード `*` 使用可） |
| `allowed_ssids` | Yes | 許可SSIDの配列 |
| `vlan_id` | No | VLAN ID |
| `session_timeout` | No | セッションタイムアウト（秒） |

---

## 7. モニタリング（Monitoring）

メインメニューから `5` キーで遷移する。

### 7.1 モニタリングメニュー

```
┌ Monitoring ─────────────────────────────────────────────────┐
│                                                             │
│ (1) Statistics Dashboard                                    │
│     View system statistics and counts                       │
│                                                             │
│ (2) Session List                                            │
│     View active sessions                                    │
│                                                             │
│ (q) Back                                                    │
│     Return to main menu                                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

| キー | 動作 |
|------|------|
| `1` | Statistics Dashboard画面へ |
| `2` | Session List画面へ |
| `q` / `Esc` | メインメニューへ戻る |

### 7.2 Statistics Dashboard

登録データの件数サマリを表示する画面。統計データは1分間キャッシュされ、`r` キーで手動更新できる。

```
┌ Statistics Dashboard ──────────────────────────────────────────────┐
│                                                                    │
│  System Statistics                                                 │
│                                                                    │
│    Subscribers:      24                                            │
│    RADIUS Clients:    6                                            │
│    Policies:          9                                            │
│    Active Sessions:   9                                            │
│                                                                    │
│  Last updated: 2026-02-23 20:54:11                                 │
│  (Statistics are cached for 1 minute. Press 'r' to force refresh)  │
│                                                                    │
│  Key bindings:                                                     │
│    r - Refresh statistics                                          │
│    q/Esc - Back to menu                                            │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

#### 表示項目

| 項目 | 説明 |
|------|------|
| Subscribers | 登録加入者数 |
| RADIUS Clients | 登録クライアント数 |
| Policies | 登録ポリシー数 |
| Active Sessions | アクティブセッション数 |

#### キーバインド

| キー | 動作 |
|------|------|
| `r` | 統計情報を即時再取得・表示更新 |
| `Esc` / `q` | モニタリングメニューへ戻る |
| `?` | ヘルプダイアログ表示 |

#### エラー時の表示

Valkey接続失敗時は各数値項目が `---` と表示される。ステータスバーにエラーメッセージが表示される。

### 7.3 Session List

アクティブセッションの一覧を表示する画面。

```
┌ Session List 1-9 of 9 (Page 1/1) ─────────────────────────────────────────────────┐
│ IMSI              NAS IP        Client IP    Start Time ▼  Duration       Traffic │
│ 001010000000003   172.19.0.1                 02-22 22:50   22h 5m 21s     0B      │
│ 001010000000006   172.19.0.1                 02-22 22:50   22h 5m 58s     0B      │
│ 001010000000003   172.19.0.1                 02-22 22:43   22h 12m 36s    0B      │
│ 001010000000001   172.19.0.1                 02-22 22:43   22h 12m 46s    0B      │
│ :                 :             :             :             :              :      │
└───────────────────────────────────────────────────────────────────────────────────┘
```

#### 表示カラム

| カラム | 内容 | 表示形式 |
|--------|------|---------|
| IMSI | 加入者識別番号 | 15桁 |
| NAS IP | NAS IPアドレス | - |
| Client IP | クライアントIPアドレス | 空欄の場合あり |
| Start Time | セッション開始時刻 | `MM-DD HH:MM` 短縮形式 |
| Duration | セッション経過時間 | `XXh XXm XXs` 形式（橙色表示） |
| Traffic | 通信量合計 | `0B`, `1.2KB`, `5.3MB` 等（緑色表示） |

ソートインジケータ `▼`（緑色）がアクティブなソートカラムに表示される。

#### ソート切替

| キー | 動作 |
|------|------|
| `i` | IMSI昇順に切替 |
| `t` | Start Time降順に切替（デフォルト） |

#### キーバインド

| キー | 動作 |
|------|------|
| `PgUp` / `PgDn` | ページ切替 |
| `/` / `F6` | フィルタダイアログ表示 |
| `r` / `F5` | 一覧を再読み込み |
| `Esc` / `q` | モニタリングメニューへ戻る |
| `F1` / `?` | ヘルプダイアログ表示 |

#### フィルタ

`/` キーでフィルタダイアログが表示される。IMSI、NAS IP、Client IPを対象に部分一致で絞り込む。

```
              ┌ Filter Sessions ───────────────────────┐
              │                                        │
              │  IMSI/IP contains:  [              ]   │
              │                                        │
              │       < OK >  < Cancel >               │
              │                                        │
              └────────────────────────────────────────┘
```

### 7.4 Session Search

Session List画面から `/` キーで表示されるIMSI検索ダイアログにIMSI（15桁）を入力すると、該当IMSIのセッション詳細画面に遷移する。

**検索手順:**

1. Session List 画面で `/` キーを押す
2. IMSI検索ダイアログにIMSI（15桁の数字）を入力する
3. `OK` ボタンを押す

#### 検索結果の表示

```
┌ Session Search ────────────────────────────────────────────────────────────────────┐
│                                                                                    │
│  IMSI: 001010000000000                                                             │
│  Sessions found: 5                                                                 │
│                                                                                    │
│  Press '/' to search for another IMSI                                              │
│                                                                                    │
├ Sessions ──────────────────────────────────────────────────────────────────────────┤
│ UUID            NAS IP        Client IP    Start Time    Duration       In/Out     │
│ e499a25b...     172.19.0.1                 02-22 22:40   22h 22m 22s    0B/0B      │
│ e44f5786...     172.19.0.1                 02-22 22:40   22h 22m 16s    0B/0B      │
│ 4673e913...     172.19.0.1                 02-22 22:41   22h 22m 2s     0B/0B      │
│ 57db0767...     172.19.0.1                 02-22 22:41   22h 21m 50s    0B/0B      │
│ 1abef930...     172.19.0.1                 02-22 22:41   22h 21m 41s    0B/0B      │
└────────────────────────────────────────────────────────────────────────────────────┘
```

#### セッションテーブルの表示カラム

| カラム | 内容 | 表示形式 |
|--------|------|---------|
| UUID | セッションUUID | 先頭8文字 + `...` |
| NAS IP | NAS IPアドレス | - |
| Client IP | クライアントIPアドレス | 空欄の場合あり |
| Start Time | セッション開始時刻 | `MM-DD HH:MM` |
| Duration | セッション経過時間 | `XXh XXm XXs` |
| In/Out | 通信量（受信/送信） | `0B/0B` 形式 |

#### 結果なしの場合

該当IMSIのセッションが存在しない場合、テーブルに `No active sessions found for IMSI: {IMSI}` と表示される。

#### キーバインド

| キー | 動作 |
|------|------|
| `/` | IMSI検索ダイアログを再表示（別のIMSIで再検索） |
| `r` / `F5` | 表示中IMSIの情報を再取得 |
| `PgUp` / `PgDn` | ページ切替 |
| `Esc` / `q` | モニタリングメニューへ戻る |

---

## 8. 共通操作リファレンス

### 8.1 キーバインド一覧

#### グローバル（全画面共通）

| キー | 動作 |
|------|------|
| `F1` / `?` | ヘルプダイアログ表示 |
| `Esc` | 前の画面に戻る / キャンセル |
| `Ctrl+Q` | アプリケーション終了（確認なし） |
| `Tab` | 次のフォーカス要素へ移動 |
| `Shift+Tab` | 前のフォーカス要素へ移動 |

#### 一覧画面共通（Subscriber List, Client List, Policy List）

| キー | 動作 |
|------|------|
| `↑` / `↓` | カーソル上下移動 |
| `PgUp` / `PgDn` | ページ上下移動 |
| `←` / `→` | 前ページ / 次ページ |
| `Enter` | 選択項目の編集画面へ |
| `F2` / `n` | 新規登録画面へ |
| `F3` / `e` | 選択項目の編集画面へ |
| `F4` / `d` | 削除確認ダイアログ表示 |
| `F5` / `r` | 一覧を再読み込み |
| `F6` / `/` | フィルタ入力ダイアログ表示 |
| `q` | 前のメニューへ戻る |

#### フォーム共通（登録・編集画面）

| キー | 動作 |
|------|------|
| `Save` ボタン | 保存実行 |
| `Esc` | キャンセル（一覧画面へ戻る） |

#### ポリシー詳細フォーム固有

| キー | 動作 |
|------|------|
| `F6` | フォーム部分とルールリスト間のフォーカス切替 |
| `Ctrl+S` | 保存実行 |

#### Session List 固有

| キー | 動作 |
|------|------|
| `i` | IMSI昇順ソートに切替 |
| `t` | Start Time降順ソートに切替 |

#### Statistics Dashboard 固有

| キー | 動作 |
|------|------|
| `r` | 統計情報を即時再取得 |

### 8.2 ステータスバー

画面最下部にステータスバーが表示され、操作結果をメッセージで通知する。

| 種別 | 表示色 | 表示時間 | 例 |
|------|-------|---------|-----|
| 成功 | 緑 | 3秒 | `✓ Subscriber created (IMSI: 440101234567890)` |
| エラー | 赤 | 手動クリアまで | `✗ Failed: Invalid IMSI format` |
| 警告 | 黄 | 5秒 | `⚠ SQN is still at initial value` |
| 情報 | 白 | 3秒 | `ℹ Loaded 5 subscribers` |

### 8.3 ヘルプダイアログ

`F1` または `?` キーで表示される。2カラムレイアウトで現在使用可能なキーバインドを一覧表示する。`Enter` または `Esc` キーで閉じる。

```
┌ Help ────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  Navigation                          List Actions                            │
│  ──────────                          ────────────                            │
│  ↑         Move up                   F2        Create new                    │
│  ↓         Move down                 n         Create new (alt)              │
│  PgUp      Page up                   F3        Edit selected                 │
│  PgDn      Page down                 e         Edit selected (alt)           │
│  Tab       Next field/item           F4        Delete selected               │
│  Shift+Tab Previous field/item       d         Delete selected (alt)         │
│  Enter     Select/Confirm            F5        Refresh list                  │
│  Esc       Back/Cancel               r         Refresh list (alt)            │
│                                      F6        Filter                        │
│  Global                              /         Filter (alt)                  │
│  ──────                                                                      │
│  F1        Show this help            Policy Form                             │
│  ?         Show this help (alt)      ───────────                             │
│  q         Back/Quit                 F6        Toggle Form/Rules focus       │
│  Ctrl+Q    Exit application                                                  │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 8.4 ダイアログ共通操作

Admin TUIでは以下の種類の確認ダイアログが表示される。

| 種別 | トリガー | 選択肢 |
|------|---------|--------|
| 削除確認 | 加入者/クライアント/ポリシーの削除操作 | `[Delete]` `[Cancel]` |
| 上書き確認 | 既存キーで新規登録を試行 | `[Overwrite]` `[Cancel]` |
| 変更破棄確認 | 編集中にEscでキャンセル | `[Discard]` `[Cancel]` |
| 終了確認 | メインメニューでEsc | `[Exit]` `[Cancel]` |
| Default allow 警告 | ポリシーのDefaultを `allow` に設定して保存 | `[Save Anyway]` `[Cancel]` |
| SQN変更警告 | SQN値を変更して保存 | `[Continue]` `[Cancel]` |

---

## 改訂履歴

| 版数 | 日付 | 内容 |
|------|------|------|
| r1 | 2026-02-27 | 初版作成 |
