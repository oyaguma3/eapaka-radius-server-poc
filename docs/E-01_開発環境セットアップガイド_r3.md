# E-01 開発環境セットアップガイド (r3)

## 1. 概要

### 1.1 目的

本ドキュメントは、EAP-AKA RADIUS PoC環境の開発者がローカル環境で開発・デバッグを行うための環境構築手順を提供する。

### 1.2 スコープ

**本書で扱う範囲：**

- Go言語環境の構築
- Docker / Docker Compose環境の構築
- リポジトリのセットアップとGo Workspace設定
- 外部パッケージ依存関係の取得
- ローカル開発環境の構築と実行
- ビルド手順
- 基本的な動作確認
- デバッグ手法（ログ確認、Delve）

**本書で扱わない範囲：**

- 本番環境へのデプロイ手順（B-02「アプリケーションデプロイ手順書」を参照）
- テスト手順の詳細（T-01〜T-04「テスト仕様書」を参照）
- コーディング規約（E-02「コーディング規約」を参照）

### 1.3 関連ドキュメント

| ドキュメント | 参照内容 |
|-------------|---------|
| D-01 ミニPC版設計仕様書 (r9) | リポジトリ構成、パッケージ利用マップ |
| D-08 インフラ設定・運用設計書 (r12) | Docker Compose設定、環境変数 |
| D-09 Auth Server詳細設計書 (r9) | Auth Server環境変数、パッケージ依存 |
| D-10 Acct Server詳細設計書 (r5) | Acct Server環境変数、パッケージ依存 |
| D-11 Vector API詳細設計書 (r6) | Vector API環境変数、パッケージ依存 |
| D-12 Vector Gateway詳細設計書 (r4) | Vector Gateway環境変数、パッケージ依存 |

### 1.4 対象読者

- 本プロジェクトの開発者
- Go言語の基本知識を有する者

---

## 2. 前提条件

### 2.1 開発マシン要件

| 項目 | 要件 |
|------|------|
| OS | macOS / Linux (Ubuntu) / Windows (WSL2) |
| CPU | 2コア以上 |
| メモリ | 8GB以上推奨 |
| ストレージ | 10GB以上の空き容量 |

### 2.2 必要なソフトウェア

| ソフトウェア | 推奨バージョン | 最低要件 | 備考 |
|-------------|--------------|---------|------|
| Go | 1.25.x | 1.25.0 | 2026年1月時点の最新安定版 |
| Docker Engine | 29.x | 24.0以上 | Compose V2統合済み |
| Docker Compose | 5.x | 2.20以上 | `docker compose`コマンド使用 |
| Git | 2.x | 2.0以上 | - |

### 2.3 ネットワーク要件

| 用途 | 必要性 | 備考 |
|------|-------|------|
| パッケージ取得 | 必須 | `go get`、`docker pull`実行時 |
| 開発時 | 任意 | ローカル完結で開発可能 |

---

## 3. 環境構築手順

### 3.1 Go言語環境

#### macOS

```bash
# Homebrewを使用
brew install go

# バージョン確認
go version
# 出力例: go version go1.25.6 darwin/arm64
```

#### Linux (Ubuntu)

```bash
# 公式tarballからインストール（推奨）
wget https://go.dev/dl/go1.25.6.linux-amd64.tar.gz
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.25.6.linux-amd64.tar.gz

# パス設定（~/.bashrc または ~/.zshrc に追加）
export PATH=$PATH:/usr/local/go/bin
export PATH=$PATH:$(go env GOPATH)/bin

# 設定反映
source ~/.bashrc

# バージョン確認
go version
# 出力: go version go1.25.6 linux/amd64
```

#### Windows (WSL2)

WSL2上のUbuntuで、上記Linuxと同じ手順を実行する。

```bash
# WSL2 Ubuntuターミナルで実行
wget https://go.dev/dl/go1.25.6.linux-amd64.tar.gz
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.25.6.linux-amd64.tar.gz

# パス設定
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
echo 'export PATH=$PATH:$(go env GOPATH)/bin' >> ~/.bashrc
source ~/.bashrc

go version
```

### 3.2 Docker / Docker Compose

#### macOS

Docker Desktop for Mac をインストール。

```bash
# Homebrewを使用
brew install --cask docker

# Docker Desktop を起動後、確認
docker version
# 出力例: Docker version 29.x.x

docker compose version
# 出力例: Docker Compose version v5.x.x
```

#### Linux (Ubuntu)

```bash
# 公式インストールスクリプト
curl -fsSL https://get.docker.com | sudo sh

# ユーザーをdockerグループに追加（sudo不要化）
sudo usermod -aG docker $USER

# 再ログイン後、確認
docker version
docker compose version
```

#### Windows (WSL2)

Docker Desktop for Windows をインストールし、WSL2バックエンドを有効化。

1. Docker Desktop インストーラーを実行
2. Settings → Resources → WSL Integration で使用するディストリビューションを有効化
3. WSL2ターミナルで確認

```bash
docker version
docker compose version
```

### 3.3 Git

各OSのパッケージマネージャでインストール済みの場合が多い。

```bash
# バージョン確認
git version

# 未インストールの場合
# macOS: brew install git
# Ubuntu: sudo apt install git
```

---

## 4. リポジトリセットアップ

### 4.1 リポジトリクローン

```bash
# 作業ディレクトリへ移動
cd ~/projects  # 任意のディレクトリ

# クローン
git clone <リポジトリURL> eapaka-radius-server-poc
cd eapaka-radius-server-poc
```

### 4.2 リポジトリ構成

```
eapaka-radius-server-poc/
├── .github/
│   └── workflows/
│       └── ci.yml                # GitHub Actions CI設定
│
├── apps/                         # アプリケーションコード
│   ├── auth-server/              # RADIUS認証サーバー
│   │   ├── main.go
│   │   ├── internal/
│   │   ├── Dockerfile
│   │   └── go.mod
│   ├── acct-server/              # RADIUS課金サーバー
│   │   ├── main.go
│   │   ├── internal/
│   │   ├── Dockerfile
│   │   └── go.mod
│   ├── vector-gateway/           # ベクター取得ルーター
│   │   ├── main.go
│   │   ├── internal/
│   │   ├── Dockerfile
│   │   └── go.mod
│   ├── vector-api/               # ベクター計算API
│   │   ├── main.go
│   │   ├── internal/
│   │   ├── Dockerfile
│   │   └── go.mod
│   └── admin-tui/                # 管理コンソール（ホスト実行）
│       ├── main.go
│       ├── internal/
│       └── go.mod
│
├── pkg/                          # 共通ライブラリ
│   └── go.mod
│
├── configs/                      # 設定ファイル
│   └── fluent-bit/
│       └── fluent-bit.yaml       # Fluent Bit設定（YAML形式）
│
├── deployments/                  # 運用関連
│   ├── docker-compose.yml
│   ├── .env.example
│   └── logs_on_host/             # ログ保存先（実行時生成）
│
├── docs/                         # ドキュメント
│
├── .golangci.yml                 # golangci-lint v2設定
├── Makefile                      # Go Workspace一括操作
└── go.work                       # Go Workspace設定
```

### 4.3 Go Workspace設定

リポジトリルートに `go.work` ファイルを作成（または既存ファイルを確認）。

```bash
# go.work が存在しない場合は作成
go work init

# 各モジュールを追加
go work use ./apps/auth-server
go work use ./apps/acct-server
go work use ./apps/vector-gateway
go work use ./apps/vector-api
go work use ./apps/admin-tui
go work use ./pkg
```

**go.work の内容例：**

```
go 1.25

use (
    ./apps/auth-server
    ./apps/acct-server
    ./apps/vector-gateway
    ./apps/vector-api
    ./apps/admin-tui
    ./pkg
)
```

### 4.4 依存パッケージ取得

```bash
# 全モジュールの依存関係を一括取得
go work sync

# または各モジュールで個別に実行
cd apps/auth-server && go mod download && cd ../..
cd apps/acct-server && go mod download && cd ../..
cd apps/vector-gateway && go mod download && cd ../..
cd apps/vector-api && go mod download && cd ../..
cd apps/admin-tui && go mod download && cd ../..
cd pkg && go mod download && cd ..
```

---

## 5. 外部パッケージ依存関係

### 5.1 パッケージ一覧

本プロジェクトで使用する主要な外部パッケージ。

| カテゴリ | パッケージ | バージョン | 用途 | 利用コンポーネント |
|---------|-----------|-----------|------|-------------------|
| **RADIUS** | `layeh.com/radius` | latest | RADIUSプロトコル処理 | Auth, Acct |
| **EAP** | `github.com/oyaguma3/go-eapaka` | latest | EAP-AKAパケット処理 | Auth |
| **Milenage** | `github.com/wmnsk/milenage` | latest | AKA認証ベクター計算 | Vector API |
| **Web** | `github.com/gin-gonic/gin` | v1.x | APIサーバー | Gateway, Vector API |
| **TUI** | `github.com/rivo/tview` | latest | ターミナルUI | Admin TUI |
| **DB** | `github.com/redis/go-redis/v9` | v9.x | Valkeyクライアント | Auth, Acct, Vector API, TUI |
| **Config** | `github.com/kelseyhightower/envconfig` | v1.x | 環境変数読み込み | 全コンポーネント |
| **UUID** | `github.com/google/uuid` | v1.x | UUID生成・検証 | Auth, Acct |
| **HTTP** | `github.com/go-resty/resty/v2` | v2.x | HTTPクライアント | Auth, Gateway |
| **CB** | `github.com/sony/gobreaker` | v1.x | サーキットブレーカー | Auth |

### 5.2 パッケージ取得コマンド例

各 `go.mod` に依存関係が定義されているため、通常は `go mod download` で自動取得される。手動で追加する場合：

```bash
# 例: Auth Server に新しいパッケージを追加
cd apps/auth-server
go get github.com/example/package@latest
```

---

## 6. ローカル開発環境

### 6.1 環境変数設定

#### 開発用環境変数ファイル作成

```bash
cd deployments

# テンプレートからコピー
cp .env.example .env

# 編集
vi .env  # または任意のエディタ
```

#### 開発用 `.env` 設定例

```bash
# =============================================================================
# EAP-AKA RADIUS PoC 開発環境用設定
# =============================================================================

# -----------------------------------------------------------------------------
# 認証情報
# -----------------------------------------------------------------------------
# Valkey接続パスワード（開発用）
VALKEY_PASSWORD=dev_password_12345

# RADIUSデフォルト共有シークレット（開発用）
RADIUS_SECRET=testing123

# -----------------------------------------------------------------------------
# Vector Gateway設定
# -----------------------------------------------------------------------------
# 動作モード: gateway（PLMNルーティング）/ passthrough（全て内部APIへ）
VECTOR_GATEWAY_MODE=passthrough

# PLMNマッピング（passthrough時は空でOK）
VECTOR_GATEWAY_PLMN_MAP=

# 内部API呼び出しタイムアウト
VECTOR_GATEWAY_INTERNAL_TIMEOUT=5s

# -----------------------------------------------------------------------------
# ログ設定
# -----------------------------------------------------------------------------
# IMSIマスキング（開発時はfalse推奨、本番はtrue）
LOG_MASK_IMSI=false
```

### 6.2 Valkey単体起動（開発用）

コンポーネント単体でのデバッグ時に、Valkeyのみを起動する方法。

```bash
# 開発用Valkey起動
docker run -d \
  --name valkey-dev \
  -p 6379:6379 \
  valkey/valkey:9.0 \
  valkey-server --requirepass dev_password_12345

# 起動確認
docker ps | grep valkey-dev

# 接続テスト
docker exec -it valkey-dev valkey-cli -a dev_password_12345 ping
# 出力: PONG

# 停止・削除
docker stop valkey-dev && docker rm valkey-dev
```

### 6.3 個別コンポーネントの実行

Valkey起動後、各コンポーネントを個別に実行する方法。

#### 環境変数設定（シェル）

```bash
# 共通環境変数
export REDIS_HOST=localhost
export REDIS_PORT=6379
export REDIS_PASS=dev_password_12345
export LOG_MASK_IMSI=false
```

#### Vector API 実行

```bash
cd apps/vector-api
go run .
# 出力例: {"time":"...","level":"INFO","msg":"starting vector-api","port":8080}
```

#### Vector Gateway 実行

```bash
# 別ターミナルで実行
export REDIS_HOST=localhost
export REDIS_PORT=6379
export REDIS_PASS=dev_password_12345
export VECTOR_GATEWAY_MODE=passthrough
export VECTOR_GATEWAY_INTERNAL_URL=http://localhost:8080/api/v1/vector
export VECTOR_GATEWAY_INTERNAL_TIMEOUT=5s
export LOG_MASK_IMSI=false

cd apps/vector-gateway
go run .
```

#### Auth Server 実行

```bash
# 別ターミナルで実行
export REDIS_HOST=localhost
export REDIS_PORT=6379
export REDIS_PASS=dev_password_12345
export VECTOR_API_URL=http://localhost:8080/api/v1/vector  # Gateway経由の場合はポート変更
export RADIUS_SECRET=testing123
export LOG_MASK_IMSI=false

cd apps/auth-server
go run .
```

#### Acct Server 実行

```bash
# 別ターミナルで実行
export REDIS_HOST=localhost
export REDIS_PORT=6379
export REDIS_PASS=dev_password_12345
export RADIUS_SECRET=testing123
export LOG_MASK_IMSI=false

cd apps/acct-server
go run .
```

#### Admin TUI 実行

```bash
export REDIS_HOST=localhost
export REDIS_PORT=6379
export REDIS_PASS=dev_password_12345

cd apps/admin-tui
go run .
```

### 6.4 全コンポーネント一括起動（Docker Compose）

開発環境でも Docker Compose を使用して全コンポーネントを起動できる。

```bash
cd deployments

# イメージビルド（初回または変更時）
docker compose build

# 起動
docker compose up -d

# ログ確認（リアルタイム）
docker compose logs -f

# 特定サービスのログ
docker compose logs -f auth-server

# 状態確認
docker compose ps

# 停止
docker compose down
```

---

## 7. ビルド手順

### 7.0 Makefileによる一括操作

Go Workspace (`go.work`) 構成のため、`go build ./...` のような `./...` を使ったコマンドは使用できない。代わりに、リポジトリルートの `Makefile` で各モジュールパスを明示指定した一括操作を提供している。

| コマンド | 説明 |
|---------|------|
| `make build` | 全モジュールのビルド |
| `make test` | 全モジュールのテスト実行 |
| `make test-cover` | カバレッジ付きテスト（cover.outを生成） |
| `make test-race` | データ競合検出テスト（`CGO_ENABLED=1`が必要） |
| `make fmt` | 全ソースコードのフォーマット |
| `make vet` | 全モジュールのgo vet実行 |
| `make lint` | golangci-lintによる静的解析 |
| `make clean` | ビルド成果物・カバレッジファイルの削除 |

```bash
# 一括ビルド
make build

# 一括テスト
make test

# フォーマット + 静的解析 + テスト
make fmt && make vet && make lint && make test
```

> **注記:** `make test-race` はWSL環境ではデフォルトで `CGO_ENABLED=0` のため失敗する場合がある。GitHub Actions環境では `CGO_ENABLED=1` が有効。

### 7.1 個別ビルド

```bash
# Auth Server
cd apps/auth-server
go build -o auth-server .

# Acct Server
cd apps/acct-server
go build -o acct-server .

# Vector Gateway
cd apps/vector-gateway
go build -o vector-gateway .

# Vector API
cd apps/vector-api
go build -o vector-api .

# Admin TUI
cd apps/admin-tui
go build -o admin-tui .
```

### 7.2 クロスコンパイル

ホストOS（Ubuntu Server）用にクロスコンパイルする場合。

```bash
# Linux AMD64向け（macOSやWindows WSL2から）
cd apps/admin-tui
GOOS=linux GOARCH=amd64 go build -o admin-tui-linux .

# 本番環境へ転送
scp -P 10022 admin-tui-linux admin@<ホストIP>:~/
```

### 7.3 Dockerイメージビルド

```bash
cd deployments

# 全イメージビルド
docker compose build

# 特定サービスのみビルド
docker compose build auth-server

# キャッシュなしでビルド（依存関係更新時）
docker compose build --no-cache
```

### 7.4 ビルドオプション

本番ビルド時の推奨オプション。

```bash
# 最適化ビルド（デバッグ情報削除、サイズ削減）
go build -ldflags="-s -w" -o auth-server .

# バージョン情報埋め込み
VERSION=$(git describe --tags --always)
BUILD_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
go build -ldflags="-s -w -X main.Version=$VERSION -X main.BuildTime=$BUILD_TIME" -o auth-server .
```

### 7.5 静的解析（golangci-lint）

golangci-lint v2を使用した静的解析がプロジェクトに導入済み。

**設定ファイル:** `.golangci.yml`（v2形式: `version: "2"` 必須）

**有効リンター:**

| リンター | 用途 |
|---------|------|
| `govet` | Go標準の静的解析 |
| `errcheck` | エラーチェック漏れ検出 |
| `staticcheck` | 追加の静的解析（gosimple統合済み） |
| `unused` | 未使用コード検出 |
| `ineffassign` | 無効な代入検出 |

```bash
# Makefile経由で実行
make lint

# golangci-lint直接実行（モジュールパス明示が必要）
golangci-lint run ./pkg/... ./apps/auth-server/... ./apps/acct-server/... ./apps/vector-gateway/... ./apps/vector-api/... ./apps/admin-tui/...
```

### 7.6 CI/CD（GitHub Actions）

GitHub Actions によるCI/CDパイプラインが `main` / `develop` ブランチへのpush/PRで自動実行される。

**設定ファイル:** `.github/workflows/ci.yml`

**パイプライン:**

| ステップ | 内容 |
|---------|------|
| Checkout | リポジトリのチェックアウト |
| Setup Go | `go.work` のgoディレクティブからバージョン自動取得 |
| Build | `make build` |
| Vet | `make vet` |
| Lint | `golangci/golangci-lint-action@v7` |
| Test | `make test-race` |

---

## 8. 動作確認

### 8.1 Valkey接続確認

```bash
# Docker Compose起動後
docker compose exec valkey valkey-cli -a dev_password_12345 ping
# 出力: PONG

# データベースサイズ確認
docker compose exec valkey valkey-cli -a dev_password_12345 dbsize
# 出力: (integer) 0

# キー一覧確認
docker compose exec valkey valkey-cli -a dev_password_12345 keys '*'
```

### 8.2 Vector API動作確認

#### テスト用加入者データ投入

```bash
# Valkeyに直接投入
docker compose exec valkey valkey-cli -a dev_password_12345

# 以下、valkey-cli内で実行
HSET sub:440101234567890 ki "00112233445566778899aabbccddeeff" opc "00112233445566778899aabbccddeeff" amf "8000" sqn "000000000001"
# 出力: (integer) 4

# 確認
HGETALL sub:440101234567890

# 終了
exit
```

#### Vector API呼び出しテスト

```bash
# Vector API（またはGateway経由）へリクエスト
curl -X POST http://localhost:8080/api/v1/vector \
  -H "Content-Type: application/json" \
  -H "X-Trace-ID: test-trace-001" \
  -d '{"imsi": "440101234567890"}'

# 成功時の応答例
# {
#   "rand": "...",
#   "autn": "...",
#   "xres": "...",
#   "ck": "...",
#   "ik": "..."
# }
```

### 8.3 ヘルスチェック確認

```bash
# Vector API
curl http://localhost:8080/health
# 出力: {"status":"ok"} または 200 OK

# Vector Gateway（ポートはdocker-compose.yml参照）
curl http://localhost:8081/health  # 外部公開している場合
```

### 8.4 コンテナ状態確認

```bash
cd deployments

# 全コンテナの状態
docker compose ps

# 期待される出力
# NAME              STATUS              PORTS
# auth-server       Up (healthy)        0.0.0.0:1812->1812/udp
# acct-server       Up (healthy)        0.0.0.0:1813->1813/udp
# vector-gateway    Up (healthy)        8080/tcp
# vector-api        Up (healthy)        8080/tcp
# valkey            Up (healthy)        127.0.0.1:6379->6379/tcp
# fluent-bit        Up                  24224/tcp, 24224/udp

# ヘルスチェック詳細
docker inspect --format='{{json .State.Health}}' auth-server | jq
```

---

## 9. デバッグ手法

### 9.1 ログ確認

#### Docker Compose経由

```bash
# 全サービスのログ（リアルタイム）
docker compose logs -f

# 特定サービスのログ
docker compose logs -f auth-server

# 直近100行
docker compose logs --tail 100 auth-server

# タイムスタンプ付き
docker compose logs -f -t auth-server
```

#### ログファイル直接参照

```bash
cd deployments/logs_on_host

# リアルタイム監視
tail -f auth-server.log

# 特定event_idの検索
grep "AUTH_OK" auth-server.log

# jqによるJSON解析
cat auth-server.log | jq 'select(.event_id == "AUTH_OK")'

# 特定trace_idの追跡
cat auth-server.log | jq 'select(.trace_id == "xxxx-xxxx-xxxx")'
```

#### 個別実行時のログ

`go run .` で実行した場合、ログは標準出力に出力される。

```bash
# ログをファイルに保存しつつ表示
go run . 2>&1 | tee debug.log

# jqでリアルタイム整形
go run . 2>&1 | jq .
```

### 9.2 Delve（Goデバッガ）

#### インストール

```bash
go install github.com/go-delve/delve/cmd/dlv@latest

# パスが通っていることを確認
dlv version
```

#### デバッグ実行

```bash
cd apps/auth-server

# デバッグモードで起動
dlv debug .

# Delve プロンプトで操作
(dlv) break main.main           # ブレークポイント設定
(dlv) break internal/eap/handler.go:50  # ファイル:行番号で指定
(dlv) continue                  # 実行継続
(dlv) next                      # ステップオーバー
(dlv) step                      # ステップイン
(dlv) print variableName        # 変数表示
(dlv) locals                    # ローカル変数一覧
(dlv) stack                     # スタックトレース
(dlv) quit                      # 終了
```

#### 環境変数付きでデバッグ

```bash
# 環境変数を設定してからDelve起動
REDIS_HOST=localhost \
REDIS_PORT=6379 \
REDIS_PASS=dev_password_12345 \
dlv debug .
```

### 9.3 よくあるデバッグシナリオ

#### Valkey接続エラー

```bash
# 接続確認
docker compose exec valkey valkey-cli -a $VALKEY_PASSWORD ping

# ネットワーク確認
docker compose exec auth-server ping valkey

# 環境変数確認
docker compose exec auth-server env | grep REDIS
```

#### Vector API呼び出しエラー

```bash
# Vector API単体確認
curl -v http://localhost:8080/health

# Auth Server → Gateway → Vector API の経路確認
docker compose logs vector-gateway | grep -i error
docker compose logs vector-api | grep -i error
```

---

## 10. トラブルシューティング

### 10.1 よくある問題と対処法

| 症状 | 原因 | 対処法 |
|------|------|-------|
| `go: module not found` | Go Workspace未設定 | `go work init` と `go work use` を実行 |
| `connection refused (port 6379)` | Valkey未起動 | `docker compose up -d valkey` で起動 |
| `NOAUTH Authentication required` | Valkeyパスワード不一致 | `.env` の `VALKEY_PASSWORD` を確認 |
| `context deadline exceeded` | タイムアウト | ネットワーク確認、タイムアウト値調整 |
| `docker: command not found` | Docker未インストール | セクション3.2参照 |
| `permission denied` (Docker) | dockerグループ未参加 | `sudo usermod -aG docker $USER` 後に再ログイン |
| ポート競合 | 他プロセスがポート使用中 | `lsof -i :1812` で確認、競合プロセス停止 |

### 10.2 クリーンアップ

```bash
# Docker関連の完全クリーンアップ
cd deployments
docker compose down -v  # ボリュームも削除
docker system prune -f  # 未使用リソース削除

# Go関連のキャッシュクリア
go clean -cache -modcache -testcache
```

---

## 付録

### A. 環境変数一覧

#### 共通

| 環境変数 | 必須 | デフォルト | 説明 |
|---------|------|-----------|------|
| `REDIS_HOST` | Yes | - | Valkeyホスト名 |
| `REDIS_PORT` | Yes | - | Valkeyポート番号 |
| `REDIS_PASS` | Yes | - | Valkeyパスワード |
| `LOG_MASK_IMSI` | No | `true` | IMSIマスキング有効化 |
| `TZ` | No | `Asia/Tokyo` | タイムゾーン |

#### Auth Server

| 環境変数 | 必須 | デフォルト | 説明 |
|---------|------|-----------|------|
| `VECTOR_API_URL` | Yes | - | Vector Gateway/API URL |
| `RADIUS_SECRET` | No | - | デフォルトShared Secret |

#### Acct Server

| 環境変数 | 必須 | デフォルト | 説明 |
|---------|------|-----------|------|
| `RADIUS_SECRET` | No | - | デフォルトShared Secret |

#### Vector Gateway

| 環境変数 | 必須 | デフォルト | 説明 |
|---------|------|-----------|------|
| `VECTOR_GATEWAY_MODE` | No | `gateway` | 動作モード |
| `VECTOR_GATEWAY_INTERNAL_URL` | Yes | - | 内部Vector API URL |
| `VECTOR_GATEWAY_PLMN_MAP` | No | 空 | PLMNマッピング |
| `VECTOR_GATEWAY_INTERNAL_TIMEOUT` | No | `5s` | 内部API呼び出しタイムアウト |

#### Vector API

| 環境変数 | 必須 | デフォルト | 説明 |
|---------|------|-----------|------|
| `TEST_VECTOR_ENABLED` | No | `false` | テストベクターモード有効化（開発・テスト用） |
| `TEST_VECTOR_IMSI_PREFIX` | No | `00101` | テストベクター対象IMSIプレフィックス |

> **注記:** テストベクターモードは開発・テスト環境専用。本番環境では必ず無効化すること。

### B. ポート一覧

| ポート | プロトコル | サービス | 公開範囲 |
|-------|----------|---------|---------|
| 1812 | UDP | Auth Server | 外部公開 |
| 1813 | UDP | Acct Server | 外部公開 |
| 6379 | TCP | Valkey | localhost + Docker内部 |
| 8080 | TCP | Vector API | Docker内部のみ |
| 8080 | TCP | Vector Gateway | Docker内部のみ |
| 24224 | TCP/UDP | Fluent Bit | Docker内部のみ |

### C. 参考リンク

| リソース | URL |
|---------|-----|
| Go公式 | https://go.dev/ |
| Docker公式 | https://docs.docker.com/ |
| Valkey公式 | https://valkey.io/ |
| layeh/radius | https://github.com/layeh/radius |
| go-redis | https://github.com/redis/go-redis |
| Delve | https://github.com/go-delve/delve |

---

## 改訂履歴

| 版数 | 日付 | 内容 |
|------|------|------|
| r1 | 2026-01-22 | 初版作成 |
| r2 | 2026-01-26 | インフラ基盤統一: .env設定例のRADIUS_SECRET_KEY→RADIUS_SECRETに統一 |
| r3 | 2026-03-01 | 実装・現行ドキュメントとの整合: タイトル版数修正、関連ドキュメント版数更新、Fluent Bit設定をYAML形式に修正、Makefileセクション追加、golangci-lint/CIセクション追加、テストベクターモード環境変数追加、リポジトリ構成図更新 |
